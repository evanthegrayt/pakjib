#!/usr/bin/env ruby
#===============================================================#
#         File: spoonerise                                      #
#  Description: CLI executable for word-flipper                 #
#                                                               #
#       Author: Evan Gray                                       #
#===============================================================#

require 'optparse'
# Internals
require_relative '../lib/spoonerise'

USAGE = "USAGE: #{File.basename(__FILE__)} [OPTIONS] [WORDS]..."

def instantiate
  yield
rescue Flipper::JakPibError
  abort("Please pass more flip-able words.")
end

##
# Read in args and set options
opts = {}
OptionParser.new do |o|
  o.banner = USAGE
  o.on('-r', '--[no-]reverse', 'Reverse flipping') { |v| opts[:reverse] = v }
  o.on('-l', '--[no-]lazy', 'Skip small words')    { |v| opts[:lazy]    = v }
  o.on('-s', '--[no-]save', 'Save results in log') { |v| opts[:save]    = v }
  o.on('--exclude=WORDS', Array, 'Words to skip')  { |v| opts[:exclude] = v }
end.parse!(ARGV)

abort(USAGE) if ARGV.empty?

##
# Create instance of Flipper. I rescue the custom error and replace it with
# a more command-line friendly message.
words = instantiate { Flipper.new(ARGV, opts) }

##
# If user passed `-s`, save to log file; otherwise, just print results as string
if opts[:save]
  puts "Saving [#{words.to_s}] to #{words.logfile}"
  words.save
else
  puts words.to_s
end

