#!/usr/bin/env ruby
#===============================================================#
#         File: spoonerise                                      #
#  Description: CLI executable for word-flipper                 #
#                                                               #
#       Author: Evan Gray                                       #
#===============================================================#

require 'optparse'
# Internals
require_relative '../lib/spoonerise'

USAGE = "USAGE: #{File.basename(__FILE__)} [OPTIONS] [WORDS]..."

##
# Read in args and set options
opts = {}
OptionParser.new do |o|
  o.banner = USAGE
  o.on('-r', '--[no-]reverse', 'Reverse flipping') { |v| opts[:reverse] = v }
  o.on('-l', '--[no-]lazy', 'Skip small words') { |v| opts[:lazy] = v }
  o.on('-s', '--[no-]save', 'Save results in log') { |v| opts[:save] = v }
  o.on('-f', '--find [WORD]', 'Search log file for WORD.',
       'If WORD is not supplied, print the whole log file.') do |v|
    opts[:find] = true
    opts[:word_to_find] = v || ''
  end
  o.on('-F', '--find-with-dates [WORD]', 'Same as "-f", but print dates') do |v|
    opts[:find] = true
    opts[:word_to_find] = v || ''
    opts[:find_with_dates] = true
  end
  o.on('--exclude WORDS', Array, 'Words to skip') { |v| opts[:exclude] = v }
end.parse!(ARGV)

abort(USAGE) if ARGV.empty?

##
# Create instance of Spoonerise. I rescue the custom error and replace it with
# a more command-line friendly message.
begin
  words = Flipper.new(ARGV, opts)
  #puts words.logfile_reader.contents
rescue Flipper::JakPibError
  abort("Please pass more flip-able words.")
end

##
# If user passed `-s`, save to log file; otherwise, just print results as string
if opts[:save]
  puts "Saving [#{words.to_s}] to #{words.logfile}"
  words.save
else
  puts words.to_s
end

